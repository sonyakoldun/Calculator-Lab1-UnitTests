# Матеріали для звіту - Лабораторна робота №3

## Тема

Тестування Web API з використанням BDD підходу, SpecFlow та RestSharp

## Мета роботи

Автоматизація тестування Web API з використанням:
- BDD (Behavior-Driven Development) підходу
- SpecFlow для створення специфікацій тестів на мові Gherkin
- RestSharp для виконання HTTP запитів до RESTful API
- Перевірка коректності роботи CRUD операцій через Web API

## Короткі теоретичні відомості

### BDD (Behavior-Driven Development)

BDD — методологія розробки програмного забезпечення, яка поєднує техніки та інструменти з domain-driven design, object-oriented design та agile software development. Основна ідея BDD — виражати поведінку системи природною мовою, зрозумілою як для технічних, так і для нетехнічних учасників проекту.

**Переваги BDD:**
- Покращена комунікація між членами команди
- Документація як код (executable specifications)
- Зменшення недорозумінь щодо вимог
- Тести стають живим документом функціональності

### Gherkin

Gherkin — це структурована мова для опису поведінки системи, яка використовується в BDD. Вона використовує ключові слова:
- **Feature** — описує функціональність
- **Scenario** — описує конкретний сценарій використання
- **Given** — передумови (preconditions)
- **When** — дія (action)
- **Then** — очікуваний результат (expected result)
- **And/But** — додаткові умови

**Приклад:**
```gherkin
Функція: Створення бронювання
  Сценарій: Успішне створення бронювання
    Дано базова API доступна
    Коли я створюю бронювання з валідними даними
    Тоді статус відповіді повинен бути 200
    І booking id повинен бути повернутий
```

### SpecFlow

SpecFlow — це фреймворк для .NET, який дозволяє використовувати BDD підхід з мовою Gherkin. Він автоматично генерує код з .feature файлів та інтегрується з тестовими фреймворками (NUnit, xUnit, MSTest).

**Основні компоненти SpecFlow:**
- Feature файли (.feature) — опис сценаріїв на Gherkin
- Step Definitions — реалізація кроків з feature файлів
- Hooks — BeforeScenario, AfterScenario для ініціалізації та очищення
- ScenarioContext — контекст для передачі даних між кроками

### RestSharp

RestSharp — це простий REST та HTTP API клієнт для .NET. Він забезпечує простий спосіб виконання HTTP запитів та обробки відповідей.

**Основні можливості:**
- Виконання GET, POST, PUT, PATCH, DELETE запитів
- Автоматична серіалізація/десеріалізація JSON
- Робота з headers, cookies, query parameters
- Підтримка аутентифікації

**Приклад використання:**
```csharp
var client = new RestClient("https://api.example.com");
var request = new RestRequest("/resource", Method.Get);
var response = client.Execute<MyModel>(request);
```

### CRUD операції

CRUD — акронім від Create, Read, Update, Delete — базові операції для роботи з даними:
- **Create (POST)** — створення нового ресурсу
- **Read (GET)** — читання існуючого ресурсу
- **Update (PUT/PATCH)** — оновлення існуючого ресурсу
  - PUT — повне оновлення
  - PATCH — часткове оновлення
- **Delete (DELETE)** — видалення ресурсу

**HTTP методи та статус коди:**
- POST → 201 Created (успішне створення)
- GET → 200 OK (успішне отримання)
- PUT/PATCH → 200 OK (успішне оновлення)
- DELETE → 200/201/204 (успішне видалення)
- Помилки → 400 Bad Request, 404 Not Found, 500 Internal Server Error

### RESTful API

REST (Representational State Transfer) — архітектурний стиль для проектування веб-сервісів. Основні принципи:
- Безстанусність (stateless)
- Використання стандартних HTTP методів
- Ресурси ідентифікуються URL
- JSON як формат обміну даними

## Хід роботи

### Крок 1: Створення solution та тестового проєкту

1. Створено solution файл `Lab3.ApiTesting.RestSharp.sln`
2. Створено тестовий проєкт xUnit з підтримкою SpecFlow
3. Додано необхідні NuGet пакети:
   - SpecFlow 3.9.74
   - SpecFlow.xUnit 3.9.74
   - SpecFlow.Tools.MsBuild.Generation 3.9.74
   - RestSharp 110.2.0
   - FluentAssertions 6.12.0
   - Newtonsoft.Json 13.0.3
   - Microsoft.Extensions.Configuration 8.0.0

### Крок 2: Створення структури проєкту

Створено наступну структуру папок:
- **Clients/** — API клієнти для роботи з зовнішніми API
- **Models/** — моделі даних (DTO) для request/response
- **Features/** — Gherkin feature файли
- **StepDefinitions/** — реалізація кроків з feature файлів
- **Hooks/** — SpecFlow hooks для ініціалізації та очищення
- **Support/** — допоміжні класи (Config, Context)

### Крок 3: Реалізація API клієнтів

#### RestfulBookerClient
Створено клієнт з методами:
- `CreateBooking(Booking)` — створення бронювання
- `GetBooking(int)` — отримання бронювання за ID
- `UpdateBooking(int, string, Booking)` — повне оновлення (PUT)
- `PartialUpdateBooking(int, string, object)` — часткове оновлення (PATCH)
- `DeleteBooking(int, string)` — видалення бронювання
- `CreateToken(string, string)` — отримання токену аутентифікації

#### CatFactsClient
Створено клієнт для роботи з Cat Facts API:
- `GetRandomFact()` — отримання випадкового факту про котів
- `GetFacts(int, int)` — отримання списку фактів з параметрами

### Крок 4: Створення моделей даних

Створено моделі для RestfulBooker API:
- `Booking` — модель бронювання
- `BookingDates` — модель дат (checkin/checkout)
- `CreateBookingResponse` — модель відповіді на створення
- `AuthRequest` / `AuthResponse` — моделі для аутентифікації

Створено моделі для Cat Facts API:
- `CatFactResponse` — модель відповіді з фактом

### Крок 5: Створення Gherkin сценаріїв

#### RestfulBookerCrud.feature
Створено 4 сценарії:
1. **Створення та отримання бронювання**
   - Перевірка створення бронювання
   - Перевірка повернення booking ID
   - Перевірка отримання створеного бронювання
   - Перевірка відповідності даних

2. **Оновлення бронювання через PUT**
   - Отримання токену аутентифікації
   - Створення бронювання
   - Оновлення бронювання
   - Перевірка оновлених даних

3. **Видалення бронювання**
   - Отримання токену та створення бронювання
   - Видалення бронювання
   - Перевірка, що бронювання видалено

4. **Негативний кейс**
   - Спроба отримати неіснуюче бронювання
   - Перевірка повернення 404

#### CatFactsApi.feature
Створено 2 сценарії:
1. **Отримання випадкового факту**
   - GET запит до /fact
   - Перевірка статусу 200
   - Перевірка наявності факту та його довжини

2. **Негативний кейс**
   - Запит до неіснуючого endpoint
   - Перевірка повернення 404

### Крок 6: Реалізація Step Definitions

#### RestfulBookerSteps
Реалізовано всі кроки для RestfulBooker сценаріїв:
- Перевірка доступності API
- Створення бронювання з валідними даними
- Перевірка статусів відповідей
- Отримання бронювання за ID
- Перевірка відповідності даних
- Аутентифікація та отримання токену
- Оновлення та видалення бронювання

#### CatFactsSteps
Реалізовано кроки для Cat Facts сценаріїв:
- Перевірка доступності API
- Отримання випадкового факту
- Перевірка структури відповіді
- Обробка негативних кейсів

### Крок 7: Налаштування конфігурації

Створено `appsettings.json` для зберігання:
- Base URLs для API
- Credentials для аутентифікації

Створено `Config.cs` для читання конфігурації з підтримкою змінних оточення.

Створено `specflow.json` для налаштування SpecFlow (мовна підтримка).

### Крок 8: Реалізація Hooks та Context

#### ScenarioHooks
Реалізовано BeforeScenario hook для:
- Створення та реєстрації API клієнтів
- Створення та реєстрації контексту тесту

Реалізовано AfterScenario hook для очищення ресурсів.

#### TestContext
Клас для зберігання даних між кроками:
- BookingId — ID створеного бронювання
- AuthToken — токен аутентифікації
- CreatedBooking / UpdatedBooking — дані бронювання
- LastResponseStatus / LastResponseBody — остання відповідь

### Крок 9: Тестування

**Тестування RestfulBooker API:**
- Виконано тестування CRUD операцій
- Перевірено створення, читання, оновлення та видалення бронювань
- Перевірено негативні кейси

**Тестування Cat Facts API:**
- Виконано тестування GET запитів
- Перевірено структуру відповідей
- Перевірено обробку помилок

## Результати тестування

### RestfulBooker API

✅ **Створення та отримання бронювання** — PASSED
- Бронювання успішно створюється
- Booking ID коректно повертається
- Дані бронювання відповідають створеним

✅ **Оновлення бронювання** — PASSED
- Аутентифікація працює коректно
- Оновлення виконується успішно
- Оновлені дані зберігаються та повертаються

✅ **Видалення бронювання** — PASSED
- Видалення виконується успішно
- Після видалення бронювання недоступне

✅ **Негативний кейс** — PASSED
- Неіснуюче бронювання повертає 404

### Cat Facts API

✅ **Отримання випадкового факту** — PASSED
- API доступний та працює
- Факт повертається коректно
- Структура відповіді правильна

✅ **Негативний кейс** — PASSED
- Неіснуючий endpoint повертає 404

## Висновки

1. **Успішно реалізовано автоматизацію тестування Web API:**
   - Використано BDD підхід з Gherkin та SpecFlow
   - Створено чисту архітектуру з розділенням відповідальності
   - Всі CRUD операції протестовано та працюють коректно

2. **Переваги використаного підходу:**
   - Специфікації тестів читабельні та зрозумілі для нетехнічних учасників
   - Тести легко підтримувати та розширювати
   - Використання FluentAssertions робить assertions читабельними
   - Конфігурація через appsettings.json дозволяє легко змінювати налаштування

3. **Особливості реалізації:**
   - Кожен тест незалежний (самостійно створює та очищає дані)
   - Немає "магічних" sleep'ів — тільки коректні перевірки відповідей
   - Використано Dependency Injection для управління залежностями
   - Контекст тесту дозволяє передавати дані між кроками

4. **Практичне застосування:**
   - Підхід може бути використаний для тестування будь-яких RESTful API
   - Легко додавати нові сценарії через Gherkin
   - Код готовий для інтеграції в CI/CD pipeline

## Посилання

**GitHub репозиторій:**  
[Посилання на репозиторій буде додано після публікації]

**API документація:**
- RestfulBooker: https://restful-booker.herokuapp.com/apidoc/index.html
- Cat Facts: https://catfact.ninja/

**Документація інструментів:**
- SpecFlow: https://docs.specflow.org/
- RestSharp: https://restsharp.dev/
- FluentAssertions: https://fluentassertions.com/
- xUnit: https://xunit.net/

## Скріншоти для звіту

### 1. Структура проєкту
Показати структуру папок та файлів проєкту в IDE або через tree команду.

### 2. Приклад feature-файлу
Показати вміст `RestfulBookerCrud.feature` з описом сценаріїв на Gherkin.

### 3. Приклад StepDefinitions
Показати реалізацію кроків з `RestfulBookerSteps.cs`.

### 4. Результат виконання тестів
Показати вивід команди `dotnet test` з результатами проходження всіх тестів.

### 5. Приклад API клієнта
Показати код `RestfulBookerClient.cs` з методами для CRUD операцій.

### 6. Конфігурація
Показати вміст `appsettings.json` та `specflow.json`.

---

**Примітка:** Всі скріншоти мають бути чіткими та зрозумілими, з видимим кодом та результатами виконання.

